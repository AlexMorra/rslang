<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>



<script>

    function get_user() {
        let token = localStorage.getItem('token');
        let user_id = localStorage.getItem('user_id');
        return fetch(`https://afternoon-falls-25894.herokuapp.com/users/${user_id}`, {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
        })
            .then(response => {
                if (response.ok) return response.json();
                if (response.status === 401) {
                    console.log('Access token is missing or invalid')
                } else if (response.status === 404) {
                    console.log('Settings not found.')
                } else {
                    console.log('User not found')
                }
                return false
            })
            .then(response_json => {
                console.log(response_json)
                return true
            })
            .catch(error => console.log(error))
    }


    function create_user(email, password) {
        let user = JSON.stringify({'email': email, 'password': password});
        return fetch('https://afternoon-falls-25894.herokuapp.com/users', {
            method: 'POST',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body : user
        })
            .then(response => response.json())
            .then(response_json => response_json);
    }


    function login_user(email, password) {
        let user = JSON.stringify({'email': email, 'password': password});
        return fetch('https://afternoon-falls-25894.herokuapp.com/signin', {
            method: 'POST',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: user
        })
            .then(response => {
                if (response.ok) return response.json();
                if (response.status === 403) {
                    console.log('Incorrect e-mail or password.')
                } else {
                    console.log('Something went wrong.')
                }
                return false
            })
            .then(response_json => {
                localStorage.setItem('token', response_json.token);
                localStorage.setItem('user_id', response_json.userId);
                return true
            })
            .catch(error => console.log(error))
    }

    function get_user_settings() {
        let token = localStorage.getItem('token');
        let user_id = localStorage.getItem('user_id');
        return fetch(`https://afternoon-falls-25894.herokuapp.com/users/${user_id}/settings`, {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
        })
            .then(response => {
                if (response.ok) return response.json();
                if (response.status === 401) {
                    console.log('Access token is missing or invalid')
                } else if (response.status === 404) {
                    console.log('Settings not found.')
                } else {
                    console.log('Something went wrong.')
                }
                return false
            })
            .then(response_json => {
                return true
            })
            .catch(error => console.log(error))
    }

    function set_user_settings(settings) {
        let set = JSON.stringify(settings)
        let token = localStorage.getItem('token');
        let user_id = localStorage.getItem('user_id');
        return fetch(`https://afternoon-falls-25894.herokuapp.com/users/${user_id}/settings`, {
            method: 'PUT',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(settings)
        })
            .then(response => {
                // console.log(response);
                if (response.ok) return response.json();
                if (response.status === 401) {
                    console.log('Access token is missing or invalid')
                } else if (response.status === 400) {
                    console.log('Bad request')
                } else {
                    console.log('Something went wrong.')
                }
                return false
            })
            .then(response_json => {
                return true
            })
            .catch(error => console.log(error))
    }

    // create_user('k77.wolf@gmail.com', '1234_Wolf')

    // login_user('k77.wolf@gmail.com', '1234_Wolf')

    // get_user_settings();

    // let settings = {
    //     "wordsPerDay": 1,
    //     "optional": {
    //         'username': 'Alexandr Kartynnik',
    //         "night_mode": true,
    //     }
    // }
    // set_user_settings(settings)




</script>
</body>
</html>